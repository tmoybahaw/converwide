<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Shaka Player Proxy + Auto Detect</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.9.3/shaka-player.compiled.js"></script>
</head>
<body style="background:#000; margin:0; display:flex; height:100vh; align-items:center; justify-content:center;">
  <video id="video" width="800" controls autoplay></video>

  <script>
    async function init() {
      shaka.polyfill.installAll();
      if (!shaka.Player.isBrowserSupported()) {
        console.error("Browser not supported!");
        return;
      }

      const video = document.getElementById('video');
      const player = new shaka.Player();
      await player.attach(video);

      // Error handling
      player.addEventListener('error', e => console.error('Shaka Error', e.detail));

      // üö® Proxy override
      const proxyScheme = (uri, request, requestType) => {
        const proxied = "/api/proxy?url=" + encodeURIComponent(uri);
        return shaka.net.HttpPlugin.parse(proxied, request, requestType);
      };
      shaka.net.NetworkingEngine.registerScheme('http', proxyScheme);
      shaka.net.NetworkingEngine.registerScheme('https', proxyScheme);

      // üîó Example streams (DASH + HLS)
      const DASH_URL = "https://linearjitp-playback.astro.com.my/dash-wv/linear/609/default_primary.mpd"
                       "https://qp-pldt-live-grp-06-prod.akamaized.net/out/u/smart_sdi8.mpd";
      const HLS_URL  = "https://aseanic.github.io/hls/28.m3u8";  // sample HLS

      // Auto-select by extension
      let manifestUri = DASH_URL;  // default
      if (HLS_URL.endsWith(".m3u8")) {
        manifestUri = HLS_URL;
      }

      // Always wrap with proxy
      manifestUri = "/api/proxy?url=" + encodeURIComponent(manifestUri);

      try {
        await player.load(manifestUri);
        console.log("‚úÖ Loaded:", manifestUri);
      } catch (err) {
        console.error("‚ùå Load failed:", err);
      }
    }

    document.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>
